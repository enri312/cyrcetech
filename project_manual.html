<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyrcetech Project Manual v2.3.0</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background: #fafafa;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
            margin-top: 1.5em;
        }

        h1 {
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.3em;
        }

        h2 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        code {
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }

        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 16px;
            border-radius: 8px;
            overflow: auto;
        }

        pre code {
            background: none;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid #3498db;
            color: #6a737d;
            padding: 0 1em;
            margin: 0;
            background: #f0f7ff;
        }

        img {
            max-width: 100%;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #3498db;
            color: white;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .toc {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false, theme: 'default' });

        document.addEventListener('DOMContentLoaded', async () => {
            const markdownContent = `
# Manual del Proyecto Cyrcetech v2.3.0

## Tabla de Contenidos
1. [IntroducciÃ³n](#1-introducciÃ³n)
2. [Diagrama de Contexto](#2-diagrama-de-contexto)
3. [Diagrama de Flujo de Datos (DFD Nivel 1)](#3-diagrama-de-flujo-de-datos-dfd-nivel-1)
4. [Casos de Uso](#4-casos-de-uso)
5. [Diagrama de Clases](#5-diagrama-de-clases)
6. [DiseÃ±o del Sistema](#6-diseÃ±o-del-sistema)
7. [ImplementaciÃ³n](#7-implementaciÃ³n)
8. [Nuevas Funcionalidades v2.3.0](#8-nuevas-funcionalidades-v230)

---

## 1. IntroducciÃ³n

Cyrcetech es un sistema integral de **GestiÃ³n de Taller de ReparaciÃ³n (SaaS / On-Premise)** diseÃ±ado para administrar Ã³rdenes de servicio, clientes, inventario y facturaciÃ³n. El sistema utiliza una arquitectura hÃ­brida con un Backend centralizado (Spring Boot) y clientes Frontend (JavaFX Desktop y React Web).

### TecnologÃ­as Clave
| Componente | TecnologÃ­a |
|------------|------------|
| Backend | Java 25, Spring Boot 3.4.0, Spring Security (JWT) |
| Frontend Desktop | JavaFX 21, Modular, CSS |
| Frontend Web | React 19 (Vite) |
| Base de Datos | PostgreSQL 18 |
| Integraciones | CyrcePDF (PDF), Apache POI (Excel), n8n (AutomatizaciÃ³n) |

---

## 2. Diagrama de Contexto

Representa al sistema como una caja negra mostrando las interacciones con actores externos.

\`\`\`mermaid
graph TB
    subgraph Actores Externos
        Admin["ğŸ‘¨â€ğŸ’¼ Administrador"]
        Tech["ğŸ‘¨â€ğŸ”§ TÃ©cnico"]
        User["ï¿½ Usuario"]
        Customer["ğŸ§‘â€ï¿½ Cliente"]
        N8N["ğŸ”„ n8n Automation"]
    end

    subgraph Sistema Cyrcetech
        SYS["ğŸ”§ Sistema de GestiÃ³n de Taller"]
    end

    Admin -->|"Gestionar Usuarios y Reportes"| SYS
    Tech -->|"Crear/Actualizar Tickets"| SYS
    User -->|"Crear Tickets, Ver Historial"| SYS
    Customer -->|"Consultar Estado"| SYS
    
    SYS -->|"Reportes Excel/PDF"| Admin
    SYS -->|"Orden de Servicio PDF"| Customer
    SYS -->|"Webhooks"| N8N
    N8N -->|"Emails AutomÃ¡ticos"| Customer
\`\`\`

### Entradas del Sistema
| Entrada | Actor | DescripciÃ³n |
|---------|-------|-------------|
| Datos de Cliente | TÃ©cnico/Admin | Nombre, telÃ©fono, direcciÃ³n, RUC/DNI |
| Datos de Equipo | TÃ©cnico | Marca, modelo, tipo, condiciÃ³n fÃ­sica |
| Orden de Servicio | TÃ©cnico | DescripciÃ³n del problema, costo estimado |
| Pagos | Admin | Registro de pagos parciales/totales |

### Salidas del Sistema
| Salida | Destino | Formato |
|--------|---------|---------|
| Orden de Servicio | Cliente | PDF |
| Factura | Cliente | PDF |
| Reporte de Tickets | Admin | Excel (.xlsx) |
| Reporte de Clientes | Admin | PDF (con antigÃ¼edad) |
| Logs de AuditorÃ­a | Admin | JSON/Tabla |

---

## 3. Diagrama de Flujo de Datos (DFD Nivel 1)

\`\`\`mermaid
flowchart TB
    subgraph Externos
        E1["ğŸ‘¨â€ğŸ”§ TÃ©cnico"]
        E2["ğŸ‘¨â€ğŸ’¼ Administrador"]
        E3["ğŸ‘¤ Usuario"]
    end

    subgraph Procesos
        P1["1.0 GestiÃ³n Clientes"]
        P2["2.0 GestiÃ³n Equipos"]
        P3["3.0 GestiÃ³n Tickets"]
        P4["4.0 FacturaciÃ³n"]
        P5["5.0 AuditorÃ­a"]
    end

    subgraph Almacenes
        D1[("customers")]
        D2[("equipment")]
        D3[("tickets")]
        D4[("invoices")]
        D5[("audit_logs")]
    end

    E1 --> P1 --> D1
    E1 --> P2 --> D2
    E1 --> P3 --> D3
    E3 --> P3
    E2 --> P4 --> D4
    E2 --> P5 --> D5
    
    P1 & P2 & P3 & P4 --> P5
\`\`\`

---

## 4. Casos de Uso

\`\`\`mermaid
graph LR
    subgraph Actores
        Admin["ğŸ‘¨â€ğŸ’¼ Admin"]
        Tech["ğŸ‘¨â€ğŸ”§ TÃ©cnico"]
        User["ï¿½ Usuario"]
    end

    subgraph Clientes
        UC1["Registrar Cliente"]
        UC2["Buscar Cliente"]
        UC4["Exportar PDF"]
    end

    subgraph Tickets
        UC8["Crear Ticket"]
        UC9["Actualizar Estado"]
        UC11["Exportar Excel"]
    end

    subgraph Admin Only
        UC12["Ver AuditorÃ­a"]
        UC13["Gestionar Usuarios"]
    end

    Tech --> UC1 & UC2 & UC8 & UC9
    User --> UC8
    Admin --> UC1 & UC4 & UC8 & UC11 & UC12 & UC13
\`\`\`

### DescripciÃ³n de Casos de Uso Principales

| ID | Caso de Uso | Actor | DescripciÃ³n |
|----|-------------|-------|-------------|
| UC1 | Registrar Cliente | TÃ©cnico/Admin | Crear nuevo cliente con datos de contacto |
| UC4 | Exportar Clientes PDF | Admin | Generar PDF con lista de clientes y antigÃ¼edad |
| UC8 | Crear Ticket | TÃ©cnico | Registrar nueva orden de servicio |
| UC9 | Actualizar Estado | TÃ©cnico | Cambiar estado (PENDING â†’ DIAGNOSING â†’ READY) |
| UC11 | Exportar Tickets Excel | Admin | Descargar todos los tickets en formato Excel |
| UC12 | Ver AuditorÃ­a | Admin | Consultar logs de acciones del sistema |

### Matriz de Permisos por Rol

| AcciÃ³n | Usuario | TÃ©cnico | Admin |
|--------|:-------:|:-------:|:-----:|
| Ver sus propios datos | âœ… | âœ… | âœ… |
| Editar su perfil | âœ… | âœ… | âœ… |
| Crear tickets | âœ… | âœ… | âœ… |
| Ver todos los tickets | âŒ | âœ… | âœ… |
| Tomar/gestionar tickets | âŒ | âœ… | âœ… |
| Crear usuarios | âŒ | âŒ | âœ… |
| Cambiar roles | âŒ | âŒ | âœ… |
| Ver reportes completos | âŒ | âŒ | âœ… |
| Configurar el sistema | âŒ | âŒ | âœ… |
| Ver auditorÃ­a | âŒ | âŒ | âœ… |
| Exportar Excel/PDF | âŒ | âœ… | âœ… |

---

## 5. Diagrama de Clases

\`\`\`mermaid
classDiagram
    class Customer {
        -String id
        -String name
        -String taxId
        -LocalDate registrationDate
        -CustomerCategory category
        +getSeniorityDays()
        +getFormattedSeniority()
        +updateCategory()
    }

    class CustomerCategory {
        <<enumeration>>
        NUEVO
        REGULAR
        VIP
        ESPECIAL
    }

    class Equipment {
        -String id
        -String brand
        -String model
        -DeviceType deviceType
        -Customer customer
        +getSummary()
    }

    class Ticket {
        -String id
        -Customer customer
        -Equipment equipment
        -TicketStatus status
        -double estimatedCost
        -double amountPaid
        +getRemainingBalance()
        +isFullyPaid()
    }

    class AuditLog {
        -String id
        -String userId
        -AuditAction action
        -String entityType
        -LocalDateTime timestamp
    }

    Customer "1" --> "*" Equipment : owns
    Customer "1" --> "*" Ticket : places
    Customer --> CustomerCategory
    Equipment "1" --> "*" Ticket : subject of
\`\`\`

---

## 6. DiseÃ±o del Sistema

### 6.1 Arquitectura Clean Architecture

\`\`\`mermaid
graph TB
    subgraph Presentation
        JFX["JavaFX Desktop"]
        React["React Web"]
    end

    subgraph API Layer
        Auth["AuthController"]
        Cust["CustomerController"]
        Tick["TicketController"]
        Audit["AuditController"]
    end

    subgraph Business Layer
        CustS["CustomerService"]
        TickS["TicketService"]
        AuditS["AuditLogService"]
        PdfS["PdfExportService"]
        ExcelS["ExcelExportService"]
    end

    subgraph Data Layer
        Repo["Repositories"]
    end

    subgraph External
        DB[("PostgreSQL")]
        N8N["n8n Webhooks"]
    end

    JFX & React --> Auth & Cust & Tick & Audit
    Cust --> CustS --> Repo --> DB
    Tick --> TickS --> Repo
    TickS --> ExcelS
    TickS --> N8N
    CustS --> PdfS
    Audit --> AuditS --> Repo
\`\`\`

### 6.2 Modelo de Datos (ERD)

\`\`\`mermaid
erDiagram
    users ||--o{ audit_logs : generates
    customers ||--o{ equipment : owns
    customers ||--o{ tickets : places
    equipment ||--o{ tickets : subject_of
    tickets ||--o{ invoices : generates

    customers {
        uuid id PK
        varchar name
        varchar tax_id UK
        date registration_date
        varchar category
    }

    equipment {
        uuid id PK
        varchar brand
        varchar model
        varchar device_type
        uuid customer_id FK
    }

    tickets {
        uuid id PK
        uuid customer_id FK
        uuid equipment_id FK
        varchar status
        decimal estimated_cost
        decimal amount_paid
        date date_created
    }

    audit_logs {
        uuid id PK
        uuid user_id
        varchar action
        varchar entity_type
        timestamp timestamp
    }
\`\`\`

### 6.3 APIs / MÃ³dulos Internos

| MÃ³dulo | FunciÃ³n | Entradas | Salidas |
|--------|---------|----------|---------|
| AuthService | AutenticaciÃ³n JWT | email, password | JWT Token |
| CustomerService | CRUD Clientes | CustomerRequest | CustomerResponse |
| TicketService | GestiÃ³n Tickets | TicketRequest | TicketResponse |
| AuditLogService | Registro de acciones | action, entity | void |
| ExcelExportService | Exportar a Excel | List<Ticket> | byte[] (xlsx) |
| CustomerPdfExportService | Exportar a PDF | List<Customer> | byte[] (pdf) |

---

## 7. ImplementaciÃ³n

### 7.1 Lenguaje y LibrerÃ­as

| Componente | TecnologÃ­a | VersiÃ³n |
|------------|------------|---------|
| Lenguaje | Java | 25 |
| Framework Backend | Spring Boot | 3.4.0 |
| ORM | Spring Data JPA | 6.x |
| Seguridad | Spring Security + JWT | 6.x |
| PDF | CyrcePDF | 1.0.0 |
| Excel | Apache POI | 5.2.5 |
| Base de Datos | PostgreSQL | 18.1 |
| Frontend Desktop | JavaFX | 21 |
| Frontend Web | React + Vite | 19 |

### 7.2 Requisitos del Sistema

| Requisito | MÃ­nimo | Recomendado |
|-----------|--------|-------------|
| JDK | 21 | 25 |
| RAM | 4 GB | 8 GB |
| Disco | 500 MB | 2 GB |
| Docker | 20.x | 24.x |

### 7.3 Estructura del Proyecto

\`\`\`
cyrcetech/
â”œâ”€â”€ backend/                          # Spring Boot Backend
â”‚   â”œâ”€â”€ src/main/java/.../
â”‚   â”‚   â”œâ”€â”€ config/                   # Configuraciones
â”‚   â”‚   â”œâ”€â”€ controller/               # REST Controllers
â”‚   â”‚   â”œâ”€â”€ domain/entity/            # Entidades JPA
â”‚   â”‚   â”œâ”€â”€ dto/                      # Request/Response DTOs
â”‚   â”‚   â”œâ”€â”€ repository/               # Repositories
â”‚   â”‚   â””â”€â”€ service/                  # LÃ³gica de negocio
â”‚   â””â”€â”€ build.gradle
â”‚
â”œâ”€â”€ src/main/java/                    # JavaFX Frontend
â”‚   â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ infrastructure/api/
â”‚   â””â”€â”€ interface_adapter/controller/
â”‚
â”œâ”€â”€ frontend-web/                     # React Frontend
â”‚   â””â”€â”€ src/
â”‚
â””â”€â”€ docker-compose.yml
\`\`\`

### 7.4 Fragmentos de CÃ³digo

**CategorizaciÃ³n AutomÃ¡tica de Clientes:**
\`\`\`java
public static CustomerCategory fromDays(long days) {
    if (days <= 30) return NUEVO;
    if (days <= 180) return REGULAR;
    if (days <= 365) return VIP;
    return ESPECIAL;
}
\`\`\`

---

## 8. Nuevas Funcionalidades v2.3.0

### CategorÃ­a de Clientes
| CategorÃ­a | Rango | DescripciÃ³n |
|-----------|-------|-------------|
| NUEVO | 0-30 dÃ­as | Cliente reciente |
| REGULAR | 1-6 meses | Cliente establecido |
| VIP | 6-12 meses | Cliente fiel |
| ESPECIAL | 1+ aÃ±o | Cliente preferencial |

### Sistema de AuditorÃ­a
- Registro automÃ¡tico de todas las acciones (LIST, VIEW, CREATE, UPDATE, DELETE)
- Filtros por usuario, rol, entidad y fecha
- Solo accesible por usuarios ADMIN

### Exportaciones
- **Excel (Tickets)**: \`GET /api/tickets/export/excel\`
- **PDF (Clientes)**: \`GET /api/customers/export/pdf\`

---

*Generado automÃ¡ticamente por Antigravity AI - Diciembre 2025*
            `;

            // Render Markdown
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = marked.parse(markdownContent);

            // Render Mermaid blocks
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid');
            for (let i = 0; i < mermaidBlocks.length; i++) {
                const block = mermaidBlocks[i];
                const pre = block.parentElement;
                const code = block.textContent;

                const div = document.createElement('div');
                div.className = 'mermaid';
                div.textContent = code;

                pre.replaceWith(div);
            }

            await mermaid.run();
        });
    </script>
</head>

<body>
    <div id="content"></div>
</body>

</html>