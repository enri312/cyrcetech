<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyrcetech Project Manual v2.3.0</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background: #fafafa;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
            margin-top: 1.5em;
        }

        h1 {
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.3em;
        }

        h2 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
        }

        code {
            background-color: #f6f8fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }

        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 16px;
            border-radius: 8px;
            overflow: auto;
        }

        pre code {
            background: none;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid #3498db;
            color: #6a737d;
            padding: 0 1em;
            margin: 0;
            background: #f0f7ff;
        }

        img {
            max-width: 100%;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #3498db;
            color: white;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .toc {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .toc a {
            color: #3498db;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false, theme: 'default' });

        document.addEventListener('DOMContentLoaded', async () => {
            const markdownContent = `
# Manual del Proyecto Cyrcetech v2.3.0

## Tabla de Contenidos
1. [Introducci√≥n](#1-introducci√≥n)
2. [Diagrama de Contexto](#2-diagrama-de-contexto)
3. [Diagrama de Flujo de Datos (DFD Nivel 1)](#3-diagrama-de-flujo-de-datos-dfd-nivel-1)
4. [Casos de Uso](#4-casos-de-uso)
5. [Diagrama de Clases](#5-diagrama-de-clases)
6. [Dise√±o del Sistema](#6-dise√±o-del-sistema)
7. [Implementaci√≥n](#7-implementaci√≥n)
8. [Nuevas Funcionalidades v2.3.0](#8-nuevas-funcionalidades-v230)

---

## 1. Introducci√≥n

Cyrcetech es un sistema integral de **Gesti√≥n de Taller de Reparaci√≥n (SaaS / On-Premise)** dise√±ado para administrar √≥rdenes de servicio, clientes, inventario y facturaci√≥n. El sistema utiliza una arquitectura h√≠brida con un Backend centralizado (Spring Boot) y clientes Frontend (JavaFX Desktop y React Web).

### Tecnolog√≠as Clave
| Componente | Tecnolog√≠a |
|------------|------------|
| Backend | Java 25, Spring Boot 3.4.0, Spring Security (JWT) |
| Frontend Desktop | JavaFX 21, Modular, CSS |
| Frontend Web | React 19 (Vite) |
| Base de Datos | PostgreSQL 18 |
| Integraciones | CyrcePDF (PDF), Apache POI (Excel), n8n (Automatizaci√≥n) |

---

## 2. Diagrama de Contexto

Representa al sistema como una caja negra mostrando las interacciones con actores externos.

\`\`\`mermaid
graph TB
    subgraph Actores Externos
        Admin["üë®‚Äçüíº Administrador"]
        Tech["üë®‚Äçüîß T√©cnico"]
        User["ÔøΩ Usuario"]
        Customer["üßë‚ÄçÔøΩ Cliente"]
        N8N["üîÑ n8n Automation"]
    end

    subgraph Sistema Cyrcetech
        SYS["üîß Sistema de Gesti√≥n de Taller"]
    end

    Admin -->|"Gestionar Usuarios y Reportes"| SYS
    Tech -->|"Crear/Actualizar Tickets"| SYS
    User -->|"Crear Tickets, Ver Historial"| SYS
    Customer -->|"Consultar Estado"| SYS
    
    SYS -->|"Reportes Excel/PDF"| Admin
    SYS -->|"Orden de Servicio PDF"| Customer
    SYS -->|"Webhooks"| N8N
    N8N -->|"Emails Autom√°ticos"| Customer
\`\`\`

### Entradas del Sistema
| Entrada | Actor | Descripci√≥n |
|---------|-------|-------------|
| Datos de Cliente | T√©cnico/Admin | Nombre, tel√©fono, direcci√≥n, RUC/DNI |
| Datos de Equipo | T√©cnico | Marca, modelo, tipo, condici√≥n f√≠sica |
| Orden de Servicio | T√©cnico | Descripci√≥n del problema, costo estimado |
| Pagos | Admin | Registro de pagos parciales/totales |

### Salidas del Sistema
| Salida | Destino | Formato |
|--------|---------|---------|
| Orden de Servicio | Cliente | PDF |
| Factura | Cliente | PDF |
| Reporte de Tickets | Admin | Excel (.xlsx) |
| Reporte de Clientes | Admin | PDF (con antig√ºedad) |
| Logs de Auditor√≠a | Admin | JSON/Tabla |

---

## 3. Diagrama de Flujo de Datos (DFD Nivel 1)

\`\`\`mermaid
flowchart TB
    subgraph Externos
        E1["üë®‚Äçüîß T√©cnico"]
        E2["üë®‚Äçüíº Administrador"]
        E3["üë§ Usuario"]
    end

    subgraph Procesos
        P1["1.0 Gesti√≥n Clientes"]
        P2["2.0 Gesti√≥n Equipos"]
        P3["3.0 Gesti√≥n Tickets"]
        P4["4.0 Facturaci√≥n"]
        P5["5.0 Auditor√≠a"]
    end

    subgraph Almacenes
        D1[("customers")]
        D2[("equipment")]
        D3[("tickets")]
        D4[("invoices")]
        D5[("audit_logs")]
    end

    E1 --> P1 --> D1
    E1 --> P2 --> D2
    E1 --> P3 --> D3
    E3 --> P3
    E2 --> P4 --> D4
    E2 --> P5 --> D5
    
    P1 & P2 & P3 & P4 --> P5
\`\`\`

---

## 4. Casos de Uso

\`\`\`mermaid
graph LR
    subgraph Actores
        Admin["üë®‚Äçüíº Admin"]
        Tech["üë®‚Äçüîß T√©cnico"]
        User["ÔøΩ Usuario"]
    end

    subgraph Clientes
        UC1["Registrar Cliente"]
        UC2["Buscar Cliente"]
        UC4["Exportar PDF"]
    end

    subgraph Tickets
        UC8["Crear Ticket"]
        UC9["Actualizar Estado"]
        UC11["Exportar Excel"]
    end

    subgraph Admin Only
        UC12["Ver Auditor√≠a"]
        UC13["Gestionar Usuarios"]
    end

    Tech --> UC1 & UC2 & UC8 & UC9
    User --> UC8
    Admin --> UC1 & UC4 & UC8 & UC11 & UC12 & UC13
\`\`\`

### Descripci√≥n de Casos de Uso Principales

| ID | Caso de Uso | Actor | Descripci√≥n |
|----|-------------|-------|-------------|
| UC1 | Registrar Cliente | T√©cnico/Admin | Crear nuevo cliente con datos de contacto |
| UC4 | Exportar Clientes PDF | Admin | Generar PDF con lista de clientes y antig√ºedad |
| UC8 | Crear Ticket | T√©cnico | Registrar nueva orden de servicio |
| UC9 | Actualizar Estado | T√©cnico | Cambiar estado (PENDING ‚Üí DIAGNOSING ‚Üí READY) |
| UC11 | Exportar Tickets Excel | Admin | Descargar todos los tickets en formato Excel |
| UC12 | Ver Auditor√≠a | Admin | Consultar logs de acciones del sistema |

### Matriz de Permisos por Rol

| Acci√≥n | Usuario | T√©cnico | Admin |
|--------|:-------:|:-------:|:-----:|
| Ver sus propios datos | ‚úÖ | ‚úÖ | ‚úÖ |
| Editar su perfil | ‚úÖ | ‚úÖ | ‚úÖ |
| Crear tickets | ‚úÖ | ‚úÖ | ‚úÖ |
| Ver todos los tickets | ‚ùå | ‚úÖ | ‚úÖ |
| Tomar/gestionar tickets | ‚ùå | ‚úÖ | ‚úÖ |
| Crear usuarios | ‚ùå | ‚ùå | ‚úÖ |
| Cambiar roles | ‚ùå | ‚ùå | ‚úÖ |
| Ver reportes completos | ‚ùå | ‚ùå | ‚úÖ |
| Configurar el sistema | ‚ùå | ‚ùå | ‚úÖ |
| Ver auditor√≠a | ‚ùå | ‚ùå | ‚úÖ |
| Exportar Excel/PDF | ‚ùå | ‚úÖ | ‚úÖ |

---

## 5. Diagrama de Clases

\`\`\`mermaid
classDiagram
    class Customer {
        -String id
        -String name
        -String taxId
        -LocalDate registrationDate
        -CustomerCategory category
        +getSeniorityDays()
        +getFormattedSeniority()
        +updateCategory()
    }

    class CustomerCategory {
        <<enumeration>>
        NUEVO
        REGULAR
        VIP
        ESPECIAL
    }

    class Equipment {
        -String id
        -String brand
        -String model
        -DeviceType deviceType
        -Customer customer
        +getSummary()
    }

    class Ticket {
        -String id
        -Customer customer
        -Equipment equipment
        -TicketStatus status
        -double estimatedCost
        -double amountPaid
        +getRemainingBalance()
        +isFullyPaid()
    }

    class AuditLog {
        -String id
        -String userId
        -AuditAction action
        -String entityType
        -LocalDateTime timestamp
    }

    Customer "1" --> "*" Equipment : owns
    Customer "1" --> "*" Ticket : places
    Customer --> CustomerCategory
    Equipment "1" --> "*" Ticket : subject of
\`\`\`

---

## 6. Dise√±o del Sistema

### 6.1 Arquitectura Clean Architecture

\`\`\`mermaid
graph TB
    subgraph Presentation
        JFX["JavaFX Desktop"]
        React["React Web"]
    end

    subgraph API Layer
        Auth["AuthController"]
        Cust["CustomerController"]
        Tick["TicketController"]
        Audit["AuditController"]
    end

    subgraph Business Layer
        CustS["CustomerService"]
        TickS["TicketService"]
        AuditS["AuditLogService"]
        PdfS["PdfExportService"]
        ExcelS["ExcelExportService"]
    end

    subgraph Data Layer
        Repo["Repositories"]
    end

    subgraph External
        DB[("PostgreSQL")]
        N8N["n8n Webhooks"]
    end

    JFX & React --> Auth & Cust & Tick & Audit
    Cust --> CustS --> Repo --> DB
    Tick --> TickS --> Repo
    TickS --> ExcelS
    TickS --> N8N
    CustS --> PdfS
    Audit --> AuditS --> Repo
\`\`\`

### 6.2 Modelo de Datos (ERD)

\`\`\`mermaid
erDiagram
    users ||--o{ audit_logs : generates
    customers ||--o{ equipment : owns
    customers ||--o{ tickets : places
    equipment ||--o{ tickets : subject_of
    tickets ||--o{ invoices : generates

    customers {
        uuid id PK
        varchar name
        varchar tax_id UK
        date registration_date
        varchar category
    }

    equipment {
        uuid id PK
        varchar brand
        varchar model
        varchar device_type
        uuid customer_id FK
    }

    tickets {
        uuid id PK
        uuid customer_id FK
        uuid equipment_id FK
        varchar status
        decimal estimated_cost
        decimal amount_paid
        date date_created
    }

    audit_logs {
        uuid id PK
        uuid user_id
        varchar action
        varchar entity_type
        timestamp timestamp
    }
\`\`\`

### 6.3 APIs / M√≥dulos Internos

| M√≥dulo | Funci√≥n | Entradas | Salidas |
|--------|---------|----------|---------|
| AuthService | Autenticaci√≥n JWT | email, password | JWT Token |
| CustomerService | CRUD Clientes | CustomerRequest | CustomerResponse |
| TicketService | Gesti√≥n Tickets | TicketRequest | TicketResponse |
| AuditLogService | Registro de acciones | action, entity | void |
| ExcelExportService | Exportar a Excel | List<Ticket> | byte[] (xlsx) |
| CustomerPdfExportService | Exportar a PDF | List<Customer> | byte[] (pdf) |

---

## 7. Implementaci√≥n

### 7.1 Lenguaje y Librer√≠as

| Componente | Tecnolog√≠a | Versi√≥n |
|------------|------------|---------|
| Lenguaje | Java | 25 |
| Framework Backend | Spring Boot | 3.4.0 |
| ORM | Spring Data JPA | 6.x |
| Seguridad | Spring Security + JWT | 6.x |
| PDF | CyrcePDF | 1.0.0 |
| Excel | Apache POI | 5.2.5 |
| Base de Datos | PostgreSQL | 18.1 |
| Frontend Desktop | JavaFX | 21 |
| Frontend Web | React + Vite | 19 |

### 7.2 Requisitos del Sistema

| Requisito | M√≠nimo | Recomendado |
|-----------|--------|-------------|
| JDK | 21 | 25 |
| RAM | 4 GB | 8 GB |
| Disco | 500 MB | 2 GB |
| Docker | 20.x | 24.x |

### 7.3 Estructura del Proyecto

\`\`\`
cyrcetech/
‚îú‚îÄ‚îÄ backend/                          # Spring Boot Backend
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/.../
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configuraciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/               # REST Controllers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/entity/            # Entidades JPA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                      # Request/Response DTOs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/               # Repositories
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service/                  # L√≥gica de negocio
‚îÇ   ‚îî‚îÄ‚îÄ build.gradle
‚îÇ
‚îú‚îÄ‚îÄ src/main/java/                    # JavaFX Frontend
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/api/
‚îÇ   ‚îî‚îÄ‚îÄ interface_adapter/controller/
‚îÇ
‚îú‚îÄ‚îÄ Front-end/                        # React Frontend
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ
‚îî‚îÄ‚îÄ docker-compose.yml
\`\`\`

\`\`\`

### 7.4 Arquitectura del Frontend Web (React)

El cliente web es una SPA (Single Page Application) construida con **React 19** y **Vite**.

#### Diagrama de Componentes
\`\`\`mermaid
graph TD
    App[App.tsx] --> Auth[AuthProvider]
    Auth --> Layout
    Layout --> Sidebar
    Layout --> Main
    Main --> Views
    
    subgraph Views
        Dash[DashboardView]
        Tickets[TicketListView]
        Clients[ClientsView]
        Audit[AuditView]
    end
    
    subgraph Services
        Api[api.ts]
        Hooks[useTicketSystem]
    end
    
    Views --> Services
\`\`\`

#### Organizaci√≥n
- **\`components/ui\`**: Elementos Glassmorphism (Cards, Buttons).
- **\`views/\`**: Pantallas (AuditView, ClientsView).
- **\`services/\`**: API Client (Axios/Fetch).

### 7.5 Fragmentos de C√≥digo

**Categorizaci√≥n Autom√°tica de Clientes:**
\`\`\`java
public static CustomerCategory fromDays(long days) {
    if (days <= 30) return NUEVO;
    if (days <= 180) return REGULAR;
    if (days <= 365) return VIP;
    return ESPECIAL;
}
\`\`\`

---

## 8. Nuevas Funcionalidades v2.3.0

### Categor√≠a de Clientes
| Categor√≠a | Rango | Descripci√≥n |
|-----------|-------|-------------|
| NUEVO | 0-30 d√≠as | Cliente reciente |
| REGULAR | 1-6 meses | Cliente establecido |
| VIP | 6-12 meses | Cliente fiel |
| ESPECIAL | 1+ a√±o | Cliente preferencial |

### Sistema de Auditor√≠a
- Registro autom√°tico de todas las acciones (LIST, VIEW, CREATE, UPDATE, DELETE)
- Filtros por usuario, rol, entidad y fecha
- Solo accesible por usuarios ADMIN

### Exportaciones
- **Excel (Tickets)**: \`GET /api/tickets/export/excel\`
- **PDF (Clientes)**: \`GET /api/customers/export/pdf\`

---

*Generado autom√°ticamente por Antigravity AI - Diciembre 2025*
            `;

            // Render Markdown
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = marked.parse(markdownContent);

            // Render Mermaid blocks
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid');
            for (let i = 0; i < mermaidBlocks.length; i++) {
                const block = mermaidBlocks[i];
                const pre = block.parentElement;
                const code = block.textContent;

                const div = document.createElement('div');
                div.className = 'mermaid';
                div.textContent = code;

                pre.replaceWith(div);
            }

            await mermaid.run();
        });
    </script>
</head>

<body>
    <div id="content"></div>
</body>

</html>